# Loop Video Player ğŸ¬

ä¸€ä¸ªè½»é‡çº§çš„æ‚¬æµ®è§†é¢‘å¾ªç¯æ’­æ”¾å™¨ï¼ŒåŸºäº **FFmpeg** å®ç°ï¼Œæ”¯æŒå‡ ä¹æ‰€æœ‰è§†é¢‘æ ¼å¼ï¼Œä¸ºåç»­éŸ³è§†é¢‘ç¼–è§£ç æ‰©å±•æ‰“ä¸‹åŸºç¡€ã€‚

![Platform](https://img.shields.io/badge/platform-Windows-blue)
![Qt](https://img.shields.io/badge/Qt-6.x-green)
![C++](https://img.shields.io/badge/C++-23-orange)
![FFmpeg](https://img.shields.io/badge/FFmpeg-latest-red)

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- ğŸ”„ **æ— é™å¾ªç¯æ’­æ”¾** - è§†é¢‘è‡ªåŠ¨å¾ªç¯
- ğŸ¬ **å…¨æ ¼å¼æ”¯æŒ** - åŸºäº FFmpegï¼Œæ”¯æŒ MP4ã€MKVã€AVIã€MOVã€WebMã€RMVB ç­‰å‡ ä¹æ‰€æœ‰æ ¼å¼
- ğŸµ **éŸ³è§†é¢‘åŒæ­¥** - ç²¾ç¡®çš„éŸ³è§†é¢‘åŒæ­¥æ’­æ”¾
- ğŸš€ **è½¯ä»¶è§£ç ** - å…¼å®¹æ€§å¼ºï¼Œæ”¯æŒæ‰€æœ‰è§†é¢‘æ ¼å¼
- ğŸ“Œ **çª—å£ç½®é¡¶** - å§‹ç»ˆæ˜¾ç¤ºåœ¨æœ€ä¸Šå±‚
- ğŸ–±ï¸ **è‡ªç”±æ‹–åŠ¨** - ç‚¹å‡»çª—å£ä»»æ„ä½ç½®æ‹–åŠ¨
- ğŸ“‚ **æ‹–æ”¾æ–‡ä»¶** - ç›´æ¥æ‹–æ”¾è§†é¢‘æ–‡ä»¶åˆ°çª—å£æ’­æ”¾
- ğŸ“ **è¾¹ç¼˜è°ƒæ•´å¤§å°** - æ‹–åŠ¨çª—å£è¾¹ç¼˜è°ƒæ•´å°ºå¯¸
- ğŸ”† **é€æ˜åº¦è°ƒèŠ‚** - 50% ~ 100% å¯è°ƒ
- ğŸ–¥ï¸ **åŒå‡»å…¨å±** - åŒå‡»åˆ‡æ¢å…¨å±æ¨¡å¼
- ğŸ”§ **å¯æ‰©å±•æ¶æ„** - ä¾¿äºåç»­æ·»åŠ éŸ³è§†é¢‘ç¼–è§£ç åŠŸèƒ½

## ğŸ› ï¸ æ„å»ºè¦æ±‚

### ä¾èµ–é¡¹

| ä¾èµ– | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|
| CMake | >= 3.20 | æ„å»ºå·¥å…· |
| Qt6 | 6.x | Coreã€Guiã€Widgetsã€Multimedia |
| FFmpeg | æœ€æ–° | éŸ³è§†é¢‘ç¼–è§£ç æ ¸å¿ƒ |
| C++ ç¼–è¯‘å™¨ | C++23 | MSVC 2022 æ¨è |

### ä¸‹è½½ FFmpeg SDK

1. è®¿é—® FFmpeg ä¸‹è½½é¡µé¢ï¼š
   - https://github.com/BtbN/FFmpeg-Builds/releases

2. ä¸‹è½½æœ€æ–°ç‰ˆæœ¬ï¼ˆæ¨èä¸‹è½½ **shared** ç‰ˆæœ¬ï¼‰ï¼š
   - `ffmpeg-master-latest-win64-gpl-shared.zip`

3. è§£å‹åˆ°é¡¹ç›®çš„ `third_party/ffmpeg` ç›®å½•ï¼š

```
loop/
â”œâ”€â”€ third_party/
â”‚   â””â”€â”€ ffmpeg/
â”‚       â”œâ”€â”€ bin/
â”‚       â”‚   â”œâ”€â”€ avcodec-61.dll
â”‚       â”‚   â”œâ”€â”€ avformat-61.dll
â”‚       â”‚   â”œâ”€â”€ avutil-59.dll
â”‚       â”‚   â”œâ”€â”€ swscale-8.dll
â”‚       â”‚   â””â”€â”€ swresample-5.dll
â”‚       â”œâ”€â”€ include/
â”‚       â”‚   â”œâ”€â”€ libavcodec/
â”‚       â”‚   â”œâ”€â”€ libavformat/
â”‚       â”‚   â”œâ”€â”€ libavutil/
â”‚       â”‚   â”œâ”€â”€ libswscale/
â”‚       â”‚   â””â”€â”€ libswresample/
â”‚       â””â”€â”€ lib/
â”‚           â”œâ”€â”€ avcodec.lib
â”‚           â”œâ”€â”€ avformat.lib
â”‚           â”œâ”€â”€ avutil.lib
â”‚           â”œâ”€â”€ swscale.lib
â”‚           â””â”€â”€ swresample.lib
```

## ğŸ”¨ æ„å»ºæ­¥éª¤

### Windows (Visual Studio 2022)

```bash
# 1. åˆ›å»ºæ„å»ºç›®å½•
mkdir build
cd build

# 2. é…ç½® CMake
cmake .. -G "Visual Studio 17 2022" ^
    -DCMAKE_PREFIX_PATH="C:/Qt/6.5.2/msvc2019_64" ^
    -DFFMPEG_SDK_PATH="../third_party/ffmpeg"

# 3. æ„å»º
cmake --build . --config Release

# 4. è¿è¡Œ
cd Release
LoopVideoPlayer.exe
```

### ä½¿ç”¨ Qt Creator

1. æ‰“å¼€ Qt Creator
2. `æ–‡ä»¶` â†’ `æ‰“å¼€æ–‡ä»¶æˆ–é¡¹ç›®` â†’ é€‰æ‹© `CMakeLists.txt`
3. é…ç½® CMakeï¼šåœ¨é¡¹ç›®è®¾ç½®ä¸­æ·»åŠ  `-DFFMPEG_SDK_PATH=../third_party/ffmpeg`
4. æ„å»ºè¿è¡Œ

### ä½¿ç”¨ Visual Studio

1. æ‰“å¼€ Visual Studio 2022
2. é€‰æ‹© `æ‰“å¼€æœ¬åœ°æ–‡ä»¶å¤¹` â†’ é€‰æ‹©é¡¹ç›®ç›®å½•
3. Visual Studio ä¼šè‡ªåŠ¨æ£€æµ‹ CMakeLists.txt
4. é…ç½® CMakePresets.json ä¸­çš„è·¯å¾„
5. æ„å»ºå¹¶è¿è¡Œ

## ğŸ“– ä½¿ç”¨æ–¹æ³•

### å¯åŠ¨

```bash
# ç›´æ¥å¯åŠ¨ï¼ˆå³é”®æ‰“å¼€æ–‡ä»¶ï¼‰
LoopVideoPlayer.exe

# å‘½ä»¤è¡ŒæŒ‡å®šæ–‡ä»¶
LoopVideoPlayer.exe "D:\Videos\my_video.mp4"

# æˆ–æ‹–æ”¾æ–‡ä»¶åˆ°ç¨‹åºå›¾æ ‡/çª—å£
```

### æ“ä½œ

| æ“ä½œ | è¯´æ˜ |
|------|------|
| å·¦é”®æ‹–åŠ¨ | ç§»åŠ¨çª—å£ |
| è¾¹ç¼˜æ‹–åŠ¨ | è°ƒæ•´å¤§å° |
| åŒå‡» | å…¨å±/çª—å£åˆ‡æ¢ |
| å³é”® | æ‰“å¼€èœå• |
| é¼ æ ‡æ‚¬åœ | æ˜¾ç¤ºæ§åˆ¶æ  |
| æ‹–æ”¾æ–‡ä»¶ | ç›´æ¥æ‰“å¼€è§†é¢‘ |

### å³é”®èœå•

- ğŸ“‚ **æ‰“å¼€è§†é¢‘æ–‡ä»¶** - é€‰æ‹©è§†é¢‘
- â–¶ **æ’­æ”¾/æš‚åœ/åœæ­¢** - æ’­æ”¾æ§åˆ¶
- ğŸ”† **é€æ˜åº¦** - è°ƒæ•´çª—å£é€æ˜åº¦
- ğŸ“ **çª—å£å¤§å°** - é¢„è®¾å°ºå¯¸
- ğŸ“Œ **å§‹ç»ˆç½®é¡¶** - åˆ‡æ¢ç½®é¡¶
- âŒ **é€€å‡º** - å…³é—­ç¨‹åº

## ğŸ“ é¡¹ç›®ç»“æ„

```
loop/
â”œâ”€â”€ CMakeLists.txt              # æ„å»ºé…ç½®
â”œâ”€â”€ README.md                   # è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.cpp                # ç¨‹åºå…¥å£
â”‚   â”œâ”€â”€ FloatingVideoPlayer.h   # æ‚¬æµ®çª—å£
â”‚   â”œâ”€â”€ FloatingVideoPlayer.cpp
â”‚   â”œâ”€â”€ FFmpegPlayer.h          # FFmpeg æ’­æ”¾å™¨æ ¸å¿ƒ
â”‚   â”œâ”€â”€ FFmpegPlayer.cpp
â”‚   â”œâ”€â”€ VideoWidget.h           # è§†é¢‘æ¸²æŸ“ç»„ä»¶
â”‚   â””â”€â”€ VideoWidget.cpp
â””â”€â”€ third_party/
    â””â”€â”€ ffmpeg/                 # FFmpeg SDK (éœ€è‡ªè¡Œä¸‹è½½)
        â”œâ”€â”€ bin/                # DLL æ–‡ä»¶
        â”œâ”€â”€ include/            # å¤´æ–‡ä»¶
        â””â”€â”€ lib/                # åº“æ–‡ä»¶
```

## ğŸ—ï¸ æ¶æ„è¯´æ˜

é¡¹ç›®é‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œä¾¿äºåç»­æ‰©å±•ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     FloatingVideoPlayer         â”‚  UI å±‚ï¼šçª—å£ç®¡ç†ã€ç”¨æˆ·äº¤äº’
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         VideoWidget             â”‚  æ¸²æŸ“å±‚ï¼šè§†é¢‘å¸§æ˜¾ç¤ºã€ç¼©æ”¾
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        FFmpegPlayer             â”‚  æ’­æ”¾æ§åˆ¶å±‚ï¼šæ’­æ”¾çŠ¶æ€ã€éŸ³è§†é¢‘åŒæ­¥
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚        DecodeThread             â”‚  è§£ç å±‚ï¼šFFmpeg éŸ³è§†é¢‘è§£ç 
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒç±»è¯´æ˜

| ç±»å | èŒè´£ |
|------|------|
| `FloatingVideoPlayer` | ä¸»çª—å£ï¼Œå¤„ç†ç”¨æˆ·äº¤äº’ã€çª—å£æ‹–åŠ¨ã€å³é”®èœå• |
| `VideoWidget` | è§†é¢‘æ¸²æŸ“ç»„ä»¶ï¼Œæ¥æ”¶è§£ç åçš„å¸§å¹¶æ˜¾ç¤º |
| `FFmpegPlayer` | æ’­æ”¾å™¨æ ¸å¿ƒï¼Œç®¡ç†æ’­æ”¾çŠ¶æ€ã€éŸ³è§†é¢‘åŒæ­¥ |
| `DecodeThread` | è§£ç çº¿ç¨‹ï¼Œä½¿ç”¨ FFmpeg è¿›è¡ŒéŸ³è§†é¢‘è§£ç  |

## ğŸ¬ æ”¯æŒçš„è§†é¢‘æ ¼å¼

åŸºäº FFmpegï¼Œæ”¯æŒï¼š

| æ ¼å¼ | è¯´æ˜ |
|------|------|
| MP4, M4V | æœ€å¸¸ç”¨ |
| MKV | æ”¯æŒå¤šéŸ³è½¨/å­—å¹• |
| AVI | ä¼ ç»Ÿæ ¼å¼ |
| MOV | QuickTime |
| WebM | ç½‘é¡µè§†é¢‘ |
| WMV | Windows Media |
| FLV | Flash è§†é¢‘ |
| RMVB, RM | RealMedia |
| TS, M2TS | è“å…‰/å¹¿æ’­ |
| 3GP | æ‰‹æœºè§†é¢‘ |
| ...æ›´å¤š | FFmpeg æ”¯æŒçš„éƒ½è¡Œ |

## ğŸ”§ é»˜è®¤è®¾ç½®

| è®¾ç½® | é»˜è®¤å€¼ |
|------|--------|
| çª—å£å¤§å° | 400 Ã— 300 |
| çª—å£ä½ç½® | å±å¹•å³ä¸‹è§’ |
| é€æ˜åº¦ | 95% |
| éŸ³é‡ | 50% |
| å¾ªç¯ | æ— é™å¾ªç¯ |

## ğŸš€ åç»­æ‰©å±•è®¡åˆ’

ç”±äºé‡‡ç”¨ FFmpeg ä½œä¸ºåç«¯ï¼Œå¯ä»¥æ–¹ä¾¿åœ°æ‰©å±•ä»¥ä¸‹åŠŸèƒ½ï¼š

- [ ] **ç¡¬ä»¶åŠ é€Ÿè§£ç ** - ä½¿ç”¨ DXVA2/NVDEC/VAAPI
- [ ] **è§†é¢‘è½¬ç ** - æ ¼å¼è½¬æ¢ã€å‹ç¼©
- [ ] **è§†é¢‘æ»¤é•œ** - äº®åº¦ã€å¯¹æ¯”åº¦ã€è£å‰ªç­‰
- [ ] **å­—å¹•æ”¯æŒ** - å†…åµŒ/å¤–æŒ‚å­—å¹•
- [ ] **æˆªå›¾åŠŸèƒ½** - æˆªå–è§†é¢‘å¸§
- [ ] **GIF å¯¼å‡º** - è§†é¢‘ç‰‡æ®µè½¬ GIF
- [ ] **éŸ³é¢‘æå–** - æå–éŸ³è½¨
- [ ] **æ’­æ”¾é€Ÿåº¦** - å€é€Ÿæ’­æ”¾
- [ ] **å¿«æ·é”®æ”¯æŒ**
- [ ] **ç³»ç»Ÿæ‰˜ç›˜å›¾æ ‡**

## â“ å¸¸è§é—®é¢˜

### Q: æ‰¾ä¸åˆ° FFmpeg DLLï¼Ÿ

A: ç¡®ä¿ä»¥ä¸‹ DLL åœ¨å¯æ‰§è¡Œæ–‡ä»¶åŒç›®å½•ä¸‹ï¼š
- avcodec-xx.dll
- avformat-xx.dll
- avutil-xx.dll
- swscale-x.dll
- swresample-x.dll

æˆ–è€…å°† FFmpeg çš„ bin ç›®å½•æ·»åŠ åˆ°ç³»ç»Ÿ PATHã€‚

### Q: è§†é¢‘æ— æ³•æ’­æ”¾ï¼Ÿ

A: 
1. æ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®ï¼ˆé¿å…ä¸­æ–‡è·¯å¾„é—®é¢˜ï¼‰
2. ç¡®è®¤æ–‡ä»¶æœªæŸå
3. æ£€æŸ¥ FFmpeg DLL æ˜¯å¦å®Œæ•´
4. æŸ¥çœ‹è°ƒè¯•è¾“å‡ºçš„é”™è¯¯ä¿¡æ¯

### Q: éŸ³è§†é¢‘ä¸åŒæ­¥ï¼Ÿ

A: å½“å‰ç‰ˆæœ¬ä½¿ç”¨éŸ³é¢‘æ—¶é’Ÿè¿›è¡ŒåŒæ­¥ï¼Œå¦‚æœä»æœ‰é—®é¢˜ï¼š
1. å°è¯•é‡æ–°æ‰“å¼€è§†é¢‘
2. ä½¿ç”¨ seek è·³è½¬åç­‰å¾…åŒæ­¥

### Q: å¦‚ä½•æ·»åŠ ç¡¬ä»¶åŠ é€Ÿï¼Ÿ

A: å¯ä»¥åœ¨ `DecodeThread::openFile()` ä¸­æ·»åŠ ç¡¬ä»¶è§£ç å™¨åˆå§‹åŒ–ï¼š
```cpp
// å°è¯•ç¡¬ä»¶è§£ç 
AVBufferRef *hw_device_ctx = nullptr;
if (av_hwdevice_ctx_create(&hw_device_ctx, AV_HWDEVICE_TYPE_DXVA2, nullptr, nullptr, 0) >= 0) {
    m_videoCodecCtx->hw_device_ctx = av_buffer_ref(hw_device_ctx);
}
```

## ğŸ“ ç‰ˆæœ¬å†å²

### v2.0.0 (å½“å‰)
- ğŸ”„ ä» libmpv åˆ‡æ¢åˆ° FFmpeg
- âœ¨ æ–°å¢æ‹–æ”¾æ–‡ä»¶åŠŸèƒ½
- ğŸ—ï¸ é‡æ„ä¸ºåˆ†å±‚æ¶æ„
- ğŸ“ å®Œå–„æ–‡æ¡£

### v1.0.0
- ğŸ¬ åŸºäº libmpv çš„åˆå§‹ç‰ˆæœ¬
- âœ¨ åŸºæœ¬æ’­æ”¾åŠŸèƒ½

## ğŸ“„ è®¸å¯è¯

MIT License

---

**Made with â¤ï¸ using Qt6, C++23, and FFmpeg**
